<div class="mt-3 mb-1 pl-7">
    <div class="flex flex-col justify-center flex-wrap">
        <h1 class="text-gray-900 dark:text-gray-100 font-bold text-lg my-0">Menú Principal</h1>
        <p class="text-xs text-gray-500 dark:text-gray-400 font-medium pt-1">Operaciones - Reporte de Ventas</p>
    </div>
</div>

<div>
    <div class="mx-auto flex justify-center">
        <div id="div_vista_itinerario" class="row container-fluid">
            <div class="flex justify-left">
                <div class="w-full md:w-10/12 xxl:w-8/12">
                    <div class="border border-gray-300 rounded-lg shadow-sm mb-2 bg-white">
                        <div class="p-4">
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
                                <div class="flex items-center">
                                    <label for="fechaInicio" class="w-1/3 text-right text-xs font-medium text-gray-700 mr-2">Fecha Inicio:</label>
                                    <input type="date" id="fechaInicio" [(ngModel)]="date_fecha_inicio" (change)="changeSelectAgencia()" [max]="date_actual" class="w-2/3 border border-gray-300 rounded-md text-sm px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>

                                <div class="flex items-center">
                                    <label for="fechaFin" class="w-1/3 text-right text-xs font-medium text-gray-700 mr-2">Fecha Fin:</label>
                                    <input type="date" id="fechaFin" [(ngModel)]="date_fecha_fin" (change)="changeSelectAgencia()" [min]="date_fecha_inicio" [max]="date_actual" class="w-2/3 border border-gray-300 rounded-md text-sm px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                            </div>

                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-3">
                                <div class="flex items-center">
                                    <label for="selectCodAgencia" class="w-1/3 text-right text-xs font-medium text-gray-700 mr-2">Agencia:</label>
                                    <select id="selectCodAgencia" [(ngModel)]="agencia_id" (change)="changeSelectAgencia()" class="w-2/3 border border-gray-300 rounded-md text-sm px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option *ngFor="let agencia of ltAgencias;" [value]="agencia.agencia_id">{{agencia.c_denominacion}}</option>
                                    </select>
                                </div>

                                <div class="flex items-center">
                                    <label for="selectCodUsuario" class="w-1/3 text-right text-xs font-medium text-gray-700 mr-2">Counter:</label>
                                    <select id="selectCodUsuario" [(ngModel)]="codSelectUsuario" class="w-2/3 border border-gray-300 rounded-md text-sm px-2 py-1 focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="0" selected>TODOS</option>
                                        <option *ngFor="let ltUsuariosCounter of ListUsuariosCounter;" [value]="ltUsuariosCounter.usuario_id">{{ltUsuariosCounter.apellidoPaterno}} {{ltUsuariosCounter.apellidoMaterno}}, {{ltUsuariosCounter.nombre}}</option>
                                    </select>
                                </div>

                                <div class="flex justify-center space-x-2">
                                    <button class="bg-green-600 hover:bg-green-700 text-white text-sm px-3 py-1 rounded-md flex items-center" (click)="buscarReporteDetallado()">
                                        <i class="ki-outline ki-magnifier text-base mr-1"></i> BUSCAR
                                    </button>
                                    <button *ngIf="ListReporteDetallado.length > 0" class="bg-orange-600 hover:bg-orange-700 text-white text-sm px-3 py-1 rounded-md flex items-center" (click)="tableToExcel()">
                                        <i class="fad fa-file-excel text-base mr-1"></i> EXPORTAR
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-left">
                <div class="w-full md:w-10/12 xxl:w-8/12">
                    <div class="border border-gray-300 rounded-lg shadow-sm mb-2 bg-white">
                        <div class="p-3">
                            <div class="flex flex-wrap items-center">
                                <div class="w-1/3 text-sm font-semibold text-green-600 flex justify-center items-center text-center">
                                    PAGADOS: 
                                    <span class="ml-2 text-sm font-normal text-black">
                                        {{cantidad_pagados_pagolink}}
                                        <span *ngIf="cantidad_pagados_pagolink == 1">venta</span>
                                        <span *ngIf="cantidad_pagados_pagolink > 1">ventas</span>
                                        <span *ngIf="monto_dinero_pagados_pagolink != 0">&nbsp;(S/. {{monto_dinero_pagados_pagolink.toFixed(2)}})</span>
                                    </span>
                                </div>
                                <div class="w-1/3 text-sm font-semibold text-purple-600 flex justify-center text-center">
                                    RESERVA: 
                                    <span class="ml-2 text-sm font-normal text-black">{{cantidad_reserva}}</span>
                                </div>

                                <div class="w-1/3 text-sm font-semibold text-red-600 flex justify-center text-center">
                                    ANULADOS: 
                                    <span class="ml-2 text-sm font-normal text-black">{{cantidad_anulados}}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="flex justify-left">
                <div class="w-full">
                    <div class="border border-gray-300 rounded-lg shadow-sm mb-2 bg-white">
                        <div class="p-4">
                            <div *ngIf="ListReporteDetallado.length == 0" class="relative mx-auto text-center text-gray-400">
                                No hay registros disponibles para mostrar. <br>
                            </div>

                            <div class="overflow-x-auto">
                                <table *ngIf="ListReporteDetallado.length > 0" id="tabla_reportes" class="min-w-full table-auto divide-y divide-gray-200">
                                    <thead class="bg-gray-100">
                                        <tr class="text-gray-500 uppercase font-semibold tracking-wider">
                                            <th class="text-xss text-center">RUTA</th>
                                            <th class="text-xss text-center">TIPO</th>
                                            <th class="text-xss text-center">N° COMPROB.</th>
                                            <th class="text-xss text-center">IMPORTE</th>
                                            <th class="text-xss text-center">USUARIO VENTA</th>
                                            <th class="text-xss text-center">ESTADO</th>
                                            <th class="text-xss text-center">FECHA VENTA</th>
                                            <th class="text-xss text-center">EMAIL PASAJERO</th>
                                            <th class="text-xss text-center">CORREO</th>
                                            <th class="text-xss text-center">N° OPERACIÓN</th>
                                            <th class="text-xss text-center">OBSERVACIONES</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <tr *ngFor="let dat of ListReporteDetallado; index as i;" [ngClass]="{'bg-yellow-100': dat.delay_correo === 1}">
                                            <td class="text-xss text-left">
                                                <span class="font-semibold text-gray-700">{{dat.origen}} - {{dat.destino}}</span>
                                            </td>
                                            <td class="text-center">
                                                <img *ngIf="dat.tipforpag == 'ORBIS'" src="./assets/img/pago-efectivo2.png" class="w-11/12">
                                                <span *ngIf="dat.tipforpag == 'ORBIS'" class="hidden">{{dat.tipforpag}}</span>
                                                <span *ngIf="dat.tipforpag != 'ORBIS'" class="text-xss font-semibold text-blue-600">{{dat.tipforpag}}</span>
                                            </td>
                                            <td class="text-center">
                                                <span *ngIf="dat.c_numboleto != ''" class="text-xss font-semibold text-orange-500 underline cursor-pointer" title="Ver Venta" (click)="ver_venta_modal(dat)">
                                                    {{dat.c_numboleto}}
                                                </span>
                                                <i *ngIf="dat.c_numboleto == null" class="fad fa-eye cursor-pointer text-base" title="Ver Venta" (click)="ver_venta_modal(dat)"></i>
                                            </td>
                                            <td class="text-xss text-center text-gray-700 font-semibold">
                                                {{ dat.n_imppag | number:'1.2-2' }}
                                            </td>
                                            <td class="text-xss text-center text-gray-700 font-semibold">{{dat.c_login}}</td>
                                            <td class="text-center">
                                                <span *ngIf="dat.tipo_movimiento == 'EFECTIVO'" class="bg-green-100 text-green-600 px-2 py-1 rounded-full text-xss font-semibold">PAGADO</span>
                                                <span *ngIf="dat.tipo_movimiento == 'RESERVA'" class="bg-indigo-100 text-indigo-700 px-2 py-1 rounded-full text-xss font-semibold">RESERVA</span>
                                                <span *ngIf="dat.tipo_movimiento == 'ANULACION SISTEMA'" class="bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xss font-semibold">EXPIRADO</span>
                                                <span *ngIf="dat.tipo_movimiento == 'ANULACION'" class="bg-red-100 text-red-600 px-2 py-1 rounded-full text-xss font-semibold">ANULADO</span>
                                            </td>
                                            <td class="text-xss text-center text-gray-700 font-semibold">{{dat.audfecins}}</td>
                                            <td class="text-xss text-center text-gray-700 font-semibold">{{dat.email_pasajero}}</td>
                                            <td class="text-center">
                                                <span *ngIf="dat.correo_enviado == '1'" class="bg-green-100 text-green-600 px-2 py-1 rounded-full text-xss font-semibold">ENVIADO</span>
                                                <span *ngIf="dat.correo_enviado == '0' || dat.correo_enviado == '2'" class="bg-red-100 text-red-600 px-2 py-1 rounded-full text-xss font-semibold">NO ENVIADO</span>
                                            </td>
                                            <td class="text-xss text-center text-gray-700 font-semibold">
                                                {{dat.numero_cip ? dat.numero_cip : dat.n_numopeban}}
                                            </td>
                                            <td class="text-xss text-center text-gray-700 text-sm">
                                                {{dat.c_observaciones}}
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div *ngIf="ArrayMostrarModal['ModalVerVenta']" id="ModalVerVenta" class="fixed inset-0 z-50 flex items-center justify-center" (click)="cerrarModal('ModalVerVenta')">
    <div class="absolute inset-0 bg-black bg-opacity-50"></div>

    <div class="relative bg-white w-full max-w-5xl rounded-lg shadow-lg z-10" (click)="$event.stopPropagation()">
        <div class="flex items-center justify-between border-b border-gray-300 px-5 pt-3 pb-2">
            <h6 *ngIf="modal_tipo_movimiento != 'EFECTIVO'" class="font-bold text-gray-800 text-base">
                DETALLES DE LA VENTA <br />
                <span class="text-red-600 text-xs">{{ modal_tipo_movimiento }}</span>
            </h6>
            <h6 *ngIf="modal_tipo_movimiento == 'EFECTIVO'" class="font-bold text-gray-800 text-base">
                DETALLES DE LA VENTA <br />
                <span class="text-green-600 text-xs">{{ modal_tipo_movimiento }}</span>
            </h6>

            <i class="fa fa-times text-xl cursor-pointer" (click)="cerrarModal('ModalVerVenta')"></i>
        </div>

        <div class="px-6 py-4 text-sm text-gray-700">
            <form class="space-y-2">
                <div class="flex">
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">BOLETO :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_boleto }}</span>
                    </div>
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">NRO. CONTROL :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_nro_control }}</span>
                    </div>
                </div>

                <div class="flex">
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">PASAJERO :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_pasajero }}</span>
                    </div>
                    <div class="w-1/2 flex"></div>
                </div>

                <div class="flex">
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">NRO ASIENTO :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_nro_asiento }}</span>
                    </div>
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">IMPORTE :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_importe | number:'1.2-2' }}</span>
                    </div>
                </div>

                <div class="flex">
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">ORIGEN :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_origen }}</span>
                    </div>
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">DESTINO :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_destino }}</span>
                    </div>
                </div>

                <div class="flex">
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">FECHA PARTIDA :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_fecha_partida }}</span>
                    </div>
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">HORA PARTIDA :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_hora_partida }}</span>
                    </div>
                </div>

                <div class="flex">
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">COMPROBANTE :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_comprobante }}</span>
                    </div>
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">FORMA PAGO :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_forma_pago }}</span>
                    </div>
                </div>

                <div class="flex">
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">TIPO FORMA PAGO :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_tipo_forma_pago }}</span>
                    </div>
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">OPERADOR TARJETA :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_operador_tarjeta }}</span>
                    </div>
                </div>

                <div class="flex">
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">TARJETA CREDITO :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_tarjeta_credito }}</span>
                    </div>
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">NRO OPERACION :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_nro_operacion }}</span>
                    </div>
                </div>

                <div *ngIf="modal_numero_cip != null" class="flex">
                    <div class="w-1/2"></div>
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">NRO CIP :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_numero_cip }}</span>
                    </div>
                </div>

                <div *ngIf="modal_url_pago != null" class="flex mt-4">
                    <div class="w-1/5 text-right">
                        <label class="font-medium mr-1">URL DE PAGO :</label>
                    </div>
                    <div class="w-4/5">
                        <a target="_blank" [href]="modal_url_pago" class="underline text-blue-600" title="Click para abrir en una Nueva Pestaña">{{ modal_url_pago }}</a>
                    </div>
                </div>
            </form>
        </div>

        <div class="border-t border-gray-300 px-6 py-4 text-sm text-gray-700">
            <form class="space-y-2">
                <div class="flex">
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">USUARIO VENTA :</label>
                        <span class="w-3/5 text-orange-600 uppercase">{{ modal_usuario_venta }}</span>
                    </div>
                    <div class="w-1/2 flex">
                        <label *ngIf="modal_boleto == null" class="w-2/5 text-right font-medium mr-1">FECHA EXPIRACIÓN :</label>
                        <span *ngIf="modal_boleto == null" class="w-3/5 text-orange-600">{{ modal_fecha_expiracion }} {{ modal_hora_expiracion }}</span>

                        <label *ngIf="modal_boleto != null" class="w-2/5 text-right font-medium mr-1">PAGO REALIZADO :</label>
                        <span *ngIf="modal_boleto != null && modal_fecha_hora_pago != null" class="w-3/5 text-orange-600">{{ modal_fecha_hora_pago }}</span>
                        <span *ngIf="modal_boleto != null && modal_fecha_hora_pago == null" class="w-3/5 text-orange-600">PAGO MANUAL</span>
                    </div>
                </div>
            
                <div class="flex">
                    <div class="w-1/2 flex">
                        <label class="w-2/5 text-right font-medium mr-1">OBSERVACIONES :</label>
                        <span class="w-3/5 text-orange-600">{{ modal_observaciones }}</span>
                    </div>

                    <div *ngIf="modal_email_pasajero != null && modal_tipo_movimiento == 'RESERVA'" class="w-1/2 flex items-center">
                        <input [(ngModel)]="modal_email_pasajero" class="border border-purple-600 rounded px-2 py-1 flex-1 text-sm"/>
                        <button type="button" (click)="enviar_url_pago()" class="inline-flex items-center gap-1 rounded bg-purple-600 text-white px-3 py-1 text-xs font-semibold hover:bg-purple-700" title="Enviar URL de Pago Link">
                            <i class="fad fa-envelope"></i> ENVIAR URL
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>